<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Traveling Tastebuds | NJ & Philly Food Reviews</title>
    <link rel="stylesheet" href="/styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit&family=Poppins:ital,wght@1,700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta name="description" content="Traveling Tastebuds - Your guide to the best food spots in New Jersey and Philadelphia. Watch TikTok reviews, explore the interactive food map, and discover hidden gems.">
</head>

<body>
    <!-- Navbar -->
    <script src="/navbar-loader.js"></script>

    <!-- ===== HERO SECTION ===== -->
    <section class="hero-section">
        <div class="hero-content">
            <img src="/Images/ttbLogo.png" alt="Traveling Tastebuds" class="hero-logo">
            <h1 class="hero-title">Your Guide to the Best<br>Food in NJ & Philly</h1>
            <p class="hero-subtitle">
                Discovering hidden gems, one bite at a time. Join the Tastebuddies and explore
                the best local restaurants through honest reviews and mouthwatering content.
            </p>
            <div class="hero-cta">
                <a href="#latest-reviews" class="btn-ttb btn-ttb-primary">
                    <i class="fab fa-tiktok"></i> Watch Reviews
                </a>
                <a href="/food-map" class="btn-ttb btn-ttb-outline">
                    <i class="fas fa-map-marked-alt"></i> Explore the Map
                </a>
            </div>
            <div class="hero-stats">
                <div class="hero-stat">
                    <div class="hero-stat-number" id="spotCount">10+</div>
                    <div class="hero-stat-label">Spots Reviewed</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-number">100K+</div>
                    <div class="hero-stat-label">TikTok Followers</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-number">NJ & Philly</div>
                    <div class="hero-stat-label">Coverage Area</div>
                </div>
            </div>
        </div>
    </section>

    <!-- ===== LATEST TIKTOK REVIEWS CAROUSEL ===== -->
    <section id="latest-reviews" class="reviews-section">
        <div class="container">
            <h2 class="section-title">Latest Reviews</h2>
            <p class="section-subtitle">Swipe through our latest food adventures - each card is a real TikTok review you can watch right here</p>
            <hr class="section-divider">
        </div>
        <div class="tiktok-carousel-wrapper container">
            <button class="carousel-nav-btn prev" onclick="scrollCarousel(-1)" aria-label="Previous">
                <i class="fas fa-chevron-left"></i>
            </button>
            <div class="tiktok-scroll-container" id="tiktokCarousel">
                <!-- Cards populated by JavaScript from spots data -->
            </div>
            <button class="carousel-nav-btn next" onclick="scrollCarousel(1)" aria-label="Next">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </section>

    <!-- ===== INTERACTIVE MAP TEASER ===== -->
    <section class="map-teaser-section">
        <div class="container">
            <h2 class="section-title">Explore the Food Map</h2>
            <p class="section-subtitle">Every spot we've reviewed, pinned on an interactive map. Find your next meal.</p>
            <hr class="section-divider">
            <div class="map-teaser-card">
                <div class="map-teaser-preview">
                    <div id="mapTeaserPreview"></div>
                    <div class="map-teaser-overlay">
                        <a href="/food-map" class="btn-ttb btn-ttb-primary">
                            <i class="fas fa-expand"></i> Open Full Map
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ===== DISCOUNT PARTNERS (de-emphasized, horizontal scroll) ===== -->
    <section class="partners-section">
        <div class="container">
            <h2 class="section-title">Partner Discounts</h2>
            <p class="section-subtitle">Rock the TTB merch and get exclusive deals at these local favorites</p>
            <hr class="section-divider">
        </div>
        <div class="container">
            <div class="partners-scroll" id="partnersScroll">
                <!-- Populated by JavaScript -->
            </div>
            <div class="text-center mt-3">
                <a href="/merch" class="btn-ttb btn-ttb-accent" style="font-size: 0.9rem;">
                    <i class="fas fa-shopping-bag"></i> Shop TTB Merch
                </a>
            </div>
        </div>
    </section>

    <!-- ===== TIKTOK VIDEO MODAL ===== -->
    <div class="modal fade" id="tiktokModal" tabindex="-1" aria-labelledby="tiktokModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="tiktokModalLabel">TikTok Review</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <iframe id="tiktokIframe" width="100%" height="85vh" frameborder="0" allowfullscreen></iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== QUESTION OF THE DAY ===== -->
    <div class="backdrop"></div>
    <div class="question-of-the-day-widget d-none">
        <div class="widgetHover">
            <div class="exitBtn"
                style="background-color: var(--background-color); color: var(--header-color); width: fit-content; border-radius: 50%; padding: 0px 6px; font-size: 0.8rem;">
                X</div>
            <div style="margin: 0 auto">
                <img style="max-width: 80px; display: block; margin: 0 auto;" src="/Images/ttbLogo.png"
                    alt="Traveling Tastebuds Logo" />
            </div>
            <div class="widgetText text-center">
                Foodie <br /> Question of the Day
            </div>
        </div>
    </div>
    <div class="question-of-the-day">
        <div class="questionExitBtn">X</div>
        <h3 class="qotdTitle">Question of the Day</h3>
        <img id="question-image" src="" style="max-width: 180px; border-radius: 12px;" alt="Question Image">
        <p class="question-text"></p>
        <div class="answer">
            <input type="ttbText" placeholder="Enter your answer..." />
            <button class="submit-button">Submit</button>
        </div>
        <div class="qotdContainer">
            <p class="feedback"></p>
            <p class="leaderboard" style="margin-bottom: 0px; padding: 8px"></p>
        </div>
    </div>
    <div class="widget-chevron-left" style="opacity: 0">&#x2190;</div>

    <!-- Footer -->
    <div id="footer-container"></div>

    <!-- Scripts -->
    <script src="/js/ttb-data.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <script>
        // ========================================
        // LOAD ALL DATA DYNAMICALLY
        // ========================================
        (async function loadHomepage() {
            // Show skeleton loaders while loading
            const carousel = document.getElementById('tiktokCarousel');
            carousel.innerHTML = Array(4).fill(0).map(() =>
                '<div class="tiktok-card" style="opacity:0.5;"><div class="tiktok-card-video skeleton" style="height:380px;"></div><div class="tiktok-card-info"><div class="skeleton" style="height:18px;width:70%;margin-bottom:8px;"></div><div class="skeleton" style="height:14px;width:50%;"></div></div></div>'
            ).join('');

            let spots = [];
            try {
                spots = await TTBData.getSpots();
            } catch (err) {
                console.error('Failed to load spots:', err);
                carousel.innerHTML = '<p style="color:var(--text-muted);padding:2rem;text-align:center;">Could not load reviews right now. Please refresh the page.</p>';
                return;
            }

            if (!spots.length) {
                carousel.innerHTML = '<p style="color:var(--text-muted);padding:2rem;text-align:center;">No reviews yet â€” check back soon!</p>';
                return;
            }

            // Populate carousel
            carousel.innerHTML = '';
            spots.forEach(function (spot) {
                var card = document.createElement('div');
                card.className = 'tiktok-card';
                card.innerHTML =
                    '<div class="tiktok-card-video">' +
                    '<iframe src="https://www.tiktok.com/embed/' + spot.tiktokId + '" allowfullscreen allow="encrypted-media" loading="lazy"></iframe>' +
                    '</div>' +
                    '<div class="tiktok-card-info">' +
                    '<div class="tiktok-card-name">' + spot.name + '</div>' +
                    '<div class="tiktok-card-location"><i class="fas fa-map-marker-alt"></i> ' + spot.location + '</div>' +
                    '<div class="tiktok-card-tags">' + (spot.tags || []).map(function (t) { return '<span class="tiktok-tag">' + t + '</span>'; }).join('') + '</div>' +
                    '</div>';
                carousel.appendChild(card);
            });

            // Spot count stat
            document.getElementById('spotCount').textContent = spots.length + '+';

            // Map teaser
            var teaserMap = L.map('mapTeaserPreview', {
                zoomControl: false, scrollWheelZoom: false, dragging: false,
                touchZoom: false, doubleClickZoom: false, attributionControl: false
            }).setView([39.83, -75.10], 10);

            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; OpenStreetMap &copy; CARTO'
            }).addTo(teaserMap);

            var teaserIcon = L.divIcon({
                className: 'custom-marker',
                html: '<div style="width:14px;height:14px;background:#94b4f7;border-radius:50%;border:2px solid white;box-shadow:0 2px 8px rgba(0,0,0,0.4);"></div>',
                iconSize: [14, 14], iconAnchor: [7, 7]
            });

            spots.forEach(function (spot) {
                if (spot.lat && spot.lng) L.marker([spot.lat, spot.lng], { icon: teaserIcon }).addTo(teaserMap);
            });

            // Partner discounts
            var partnersScroll = document.getElementById('partnersScroll');
            partnersScroll.innerHTML = '';
            spots.filter(function (s) { return s.discount; }).forEach(function (spot) {
                var card = document.createElement('div');
                card.className = 'partner-card';
                card.innerHTML =
                    '<img src="' + (spot.logoImage || '') + '" alt="' + spot.name + '">' +
                    '<div class="partner-card-name">' + spot.name + '</div>' +
                    '<div class="partner-card-discount">' + spot.discount + '</div>';
                card.addEventListener('click', function () { openTikTokModal(spot.tiktokId, spot.name); });
                partnersScroll.appendChild(card);
            });
        })();

        // Carousel navigation
        function scrollCarousel(direction) {
            var container = document.getElementById('tiktokCarousel');
            container.scrollBy({ left: direction * 300, behavior: 'smooth' });
        }

        // TikTok modal
        function openTikTokModal(videoId, name) {
            document.getElementById('tiktokModalLabel').textContent = name + ' - TikTok Review';
            document.getElementById('tiktokIframe').src = 'https://www.tiktok.com/embed/' + videoId;
            new bootstrap.Modal(document.getElementById('tiktokModal')).show();
        }

        document.getElementById('tiktokModal').addEventListener('hidden.bs.modal', function () {
            document.getElementById('tiktokIframe').src = '';
        });

        // ========================================
        // QUESTION OF THE DAY
        // ========================================
        const questionWidget = document.querySelector(".question-of-the-day-widget");
        const questionWidgetExitBtn = document.querySelector(".exitBtn");
        const questionPopUp = document.querySelector(".question-of-the-day");
        const questionBackDrop = document.querySelector(".backdrop");
        const widgetChevron = document.querySelector(".widget-chevron-left");

        questionWidgetExitBtn.addEventListener("click", (event) => {
            questionWidget.style.transform = "translateX(130%)";
            widgetChevron.style.opacity = "1";
            event.stopPropagation();
        });

        widgetChevron.addEventListener("click", () => {
            questionWidget.style.transform = "translateX(0)";
            widgetChevron.style.opacity = "0";
        });

        questionWidget.addEventListener("click", () => {
            document.querySelector(".question-of-the-day").style.display = "block";
            document.querySelector(".backdrop").style.display = "block";
        });

        const questionExitBtn = document.querySelector(".questionExitBtn");
        questionExitBtn.addEventListener("click", () => {
            document.querySelector(".question-of-the-day").style.display = "none";
            document.querySelector(".backdrop").style.display = "none";
        });

        const questions = [{
            question: "Where is this food from? (Hint: It's in Glassboro, New Jersey)",
            imageUrl: "/Images/qotdImages/peterAndSons.jpeg",
            acceptedAnswers: ["peter and sons", "peter & sons", "peter &amp; sons", "peter and son"],
            correctFeedback: "Correct! Way to go, you know your New Jersey food spots! Come back tomorrow for another question!",
            incorrectFeedback: "That's not quite it - the correct answer was Peter and Sons. Stay tuned for tomorrow's Question of the Day!",
        }];

        const today = new Date();
        const questionIndex = (today.getDate() - 1) % questions.length;
        const currentQuestion = questions[questionIndex].question;
        const currentImage = questions[questionIndex].imageUrl;

        document.querySelector(".question-text").innerText = currentQuestion;
        document.getElementById("question-image").src = currentImage;

        let score = parseInt(localStorage.getItem("score")) || 0;
        let answeredCorrectly = localStorage.getItem("answeredCorrectly");
        let previousQuestion = localStorage.getItem("question");

        if (previousQuestion !== currentQuestion) {
            answeredCorrectly = false;
            localStorage.setItem("answeredCorrectly", false);
        }

        const qotdContainer = document.querySelector(".qotdContainer");
        const submitButton = document.querySelector(".submit-button");
        const feedback = document.querySelector(".feedback");
        const leaderboard = document.querySelector(".leaderboard");

        submitButton.addEventListener("click", () => {
            const answer = document.querySelector('input[type="ttbText"]').value.trim().toLowerCase();
            const acceptedAnswers = questions[questionIndex].acceptedAnswers;

            if (answeredCorrectly === "true" || answeredCorrectly === true) {
                qotdContainer.style.display = "block";
                feedback.innerText = "You already got it right! Tune in tomorrow for another foodie question!";
                leaderboard.innerHTML = "You are on a " + score + " day streak! Way to go!";
            } else if (acceptedAnswers.includes(answer)) {
                qotdContainer.style.display = "block";
                feedback.innerText = questions[questionIndex].correctFeedback;
                score++;
                answeredCorrectly = true;
                leaderboard.innerHTML = "You are on a " + score + " day streak! Way to go!";
            } else {
                qotdContainer.style.display = "block";
                feedback.innerText = questions[questionIndex].incorrectFeedback;
            }

            localStorage.setItem("score", score);
            localStorage.setItem("question", currentQuestion);
            localStorage.setItem("answeredCorrectly", answeredCorrectly);
        });

        // ========================================
        // SCROLL ANIMATIONS
        // ========================================
        const observerOptions = { threshold: 0.1 };
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, observerOptions);

        document.querySelectorAll('.fade-in-up').forEach(el => observer.observe(el));

        // ========================================
        // LOAD FOOTER
        // ========================================
        fetch('/footer.html')
            .then(r => r.text())
            .then(html => { document.getElementById('footer-container').innerHTML = html; })
            .catch(() => {});
    </script>
</body>

</html>
